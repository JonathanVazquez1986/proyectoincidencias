<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acceso - Sistema de Incidencias</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="flex flex-col items-center justify-center h-screen bg-gray-100">
    <div class="bg-white p-8 rounded-lg shadow-lg w-96">
        
        <!-- Login Form -->
        <div id="login-form">
            <h2 class="text-2xl font-bold text-center mb-4">Iniciar Sesión</h2>
            <input id="login-email" type="email" placeholder="Correo Electrónico" class="w-full p-2 mb-3 border rounded">
            <input id="login-password" type="password" placeholder="Contraseña" class="w-full p-2 mb-3 border rounded">
            <button onclick="login()" class="w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600">Ingresar</button>
            <p class="text-center mt-3">¿No tienes cuenta? <a href="#" onclick="toggleForm()" class="text-blue-500">Regístrate</a></p>
            <p id="login-error" class="text-red-500 text-center mt-3"></p>
        </div>
        
        <!-- Register Form -->
        <div id="register-form" class="hidden">
            <h2 class="text-2xl font-bold text-center mb-4">Registro</h2>
            <input id="register-nombre" type="text" placeholder="Nombre Completo" class="w-full p-2 mb-3 border rounded">
            <input id="register-email" type="email" placeholder="Correo Electrónico" class="w-full p-2 mb-3 border rounded">
            <input id="register-password" type="password" placeholder="Contraseña" class="w-full p-2 mb-3 border rounded">
            <button onclick="register()" class="w-full bg-green-500 text-white p-2 rounded hover:bg-green-600">Registrarse</button>
            <p class="text-center mt-3">¿Ya tienes cuenta? <a href="#" onclick="toggleForm()" class="text-blue-500">Inicia sesión</a></p>
            <p id="register-error" class="text-red-500 text-center mt-3"></p>
        </div>
        
    </div>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, signInWithPopup, GoogleAuthProvider, createUserWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-auth.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-firestore.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyCJYn3kJFHaJjltP9SScpgM3SEo14aWq6I",
            authDomain: "proyecto-incidencias-8923b.firebaseapp.com",
            projectId: "proyecto-incidencias-8923b",
            storageBucket: "proyecto-incidencias-8923b.firebasestorage.app",
            messagingSenderId: "719168710499",
            appId: "1:719168710499:web:ba8a21ee5ee0054d639556"
        };
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth();
        const provider = new GoogleAuthProvider();
        const db = getFirestore();
        
        function toggleForm() {
            document.getElementById("login-form").classList.toggle("hidden");
            document.getElementById("register-form").classList.toggle("hidden");
        }
        
        function login() {
            const email = document.getElementById("login-email").value;
            const password = document.getElementById("login-password").value;
            signInWithEmailAndPassword(auth, email, password)
                .then(() => {
                    console.log("Usuario autenticado con éxito");
                    window.location.href = "dashboard.html";
                })
                .catch(error => {
                    console.error("Error al iniciar sesión:", error);
                    document.getElementById("login-error").innerText = error.message;
                });
        }
        
        function register() {
            const email = document.getElementById("register-email").value;
            const password = document.getElementById("register-password").value;
            const nombre = document.getElementById("register-nombre").value;
            
            if (email && password && nombre) {
                createUserWithEmailAndPassword(auth, email, password)
                    .then(async (userCredential) => {
                        await setDoc(doc(db, "usuarios", userCredential.user.uid), {
                            nombre: nombre,
                            email: email,
                            role: "usuario"
                        });
                        console.log("Usuario registrado con éxito");
                        alert("Registro exitoso");
                        window.location.href = "dashboard.html";
                    })
                    .catch(error => {
                        console.error("Error al registrar usuario:", error);
                        document.getElementById("register-error").innerText = error.message;
                    });
            } else {
                alert("Por favor, completa todos los campos");
            }
        }
        
        // Verifica si hay un usuario autenticado y redirige al dashboard automáticamente
        onAuthStateChanged(auth, (user) => {
            if (user) {
                console.log("Usuario ya autenticado, redirigiendo al dashboard");
                window.location.href = "dashboard.html";
            }
        });
    </script>
</body>
</html>
